<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dark Sky Compliance Checker</title>
  <style>
    /* Base Styles */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    label {
      font-size: 18px;
      margin-bottom: 10px;
      display: block;
    }
    select {
      padding: 10px;
      font-size: 16px;
      width: 100%;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    /* Tabs Styling */
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .tab {
      padding: 10px 20px;
      margin: 0 5px 5px 5px;
      background: #eee;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
    .tab.active {
      background: #ddd;
      font-weight: bold;
    }
    /* Content Areas */
    .content {
      text-align: left;
      border-top: 1px solid #ccc;
      padding-top: 15px;
      margin-bottom: 20px;
    }
    /* Nested Areas */
    .nested {
      margin-top: 15px;
    }
    /* Simple Table Styling */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 1em;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    /* Title Classes */
    .section-title {
      font-size: 1.5em;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .table-title {
      font-size: 1.2em;
      margin-top: 15px;
      margin-bottom: 10px;
    }
    /* Asterisk remarks styling for Table C */
    .asterisk-remarks {
      text-align: left;
      font-size: 0.9em;
      margin-top: 10px;
    }
    /* Styles for compliance input boxes */
    input.compliance-input {
      width: 80px;
      padding: 4px;
      border: 1px solid #ccc;
      text-align: right;
    }
    /* Styles for additional allowances checkboxes */
    .allowance-checkbox {
      margin-right: 5px;
    }
    #tableETotalText {
      font-weight: bold;
    }
    #tableETotalText  {
      text-align: right;
    }
    #projectCompliance  {
      text-align: right;
    }
    #performanceComplianceContent table td {
      font-weight: normal;
    }
    #tableBMaxDisplay {
      text-align: right;
    }
    #tableBProjectValue {
      text-align: right;
    }
    .compliance-label {
      font-size: 1.25em; /* Adjust the value as needed */
    }
    
    
  </style>
  
  <!-- Include html2canvas and jsPDF from a CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>
<body>
  <div class="container">
    <!-- Global Section -->
    <h1>Dark Sky Compliance Checker</h1>
    <label for="lightingZone">Select Lighting Zone:</label>
    <select id="lightingZone">
      <option value="">-- Select Lighting Zone --</option>
      <option value="LZ0">LZ0 - no ambient lighting</option>
      <option value="LZ1">LZ1 - low ambient lighting</option>
      <option value="LZ2">LZ2 - moderate ambient lighting</option>
      <option value="LZ3">LZ3 - moderately high ambient lighting</option>
      <option value="LZ4">LZ4 - high ambient lighting</option>
    </select>

    <!-- Main Tabs -->
    <div class="tabs">
      <div class="tab" id="residentialMainTab">Residential</div>
      <div class="tab" id="nonResidentialMainTab">Non‑residential</div>
      <div class="tab" id="bugMainTab">BUG Rating</div>
    </div>

    <!-- Residential Nested Section -->
    <div id="residentialNested" class="nested" style="display: none;">
      <div class="tabs">
        <div class="tab" id="resOrdinanceTab">Ordinance</div>
        <div class="tab" id="resTablesTab">Tables</div>
        <div class="tab" id="resComplianceTab">Compliance Checker</div>
      </div>
      <div class="content" id="resOrdinanceContent" style="display: none;">
        <h2>A. General Requirements</h2>
        <p>For residential properties including multiple residential properties not having common areas, all outdoor luminaires shall be fully shielded and shall not exceed the allowed lumen output in Table G, row 2.</p>
        <h3>Exceptions</h3>
        <ol>
          <li>One partly shielded or unshielded luminaire at the main entry, not exceeding the allowed lumen output in Table G row 1.</li>
          <li>Any other partly shielded or unshielded luminaires not exceeding the allowed lumen output in Table G row 3.</li>
          <li>Low voltage landscape lighting aimed away from adjacent properties and not exceeding the allowed lumen output in Table G row 4.</li>
          <li>Shielded directional flood lighting aimed so that direct glare is not visible from adjacent properties and not exceeding the allowed lumen output in Table G row 5.</li>
          <li>Open flame gas lamps.</li>
          <li>Lighting installed with a vacancy sensor, where the sensor extinguishes the lights no more than 15 minutes after the area is vacated.</li>
          <li>Lighting exempt per Section III (B.).</li>
        </ol>
        <h2>B. Requirements for Residential Landscape Lighting</h2>
        <ol>
          <li>Shall comply with Table G.</li>
          <li>Shall not be aimed onto adjacent properties.</li>
        </ol>
      </div>
      <div class="content" id="resTablesContent" style="display: none;">
        <!-- Residential Tables Content will include Table G -->
        <div id="residentialTablesWrapper">
          <!-- Original Table G content is generated by getResidentialTableG() -->
        </div>
      </div>
      <div class="content" id="resComplianceContent" style="display: none;">
      </div>
    </div>
    
    <!-- BUG Nested Section -->
    <div id="bugNested" class="nested" style="display: none;">
      <div class="tabs">
        <div class="tab" id="bugOrdinanceTab">Ordinance</div>
        <div class="tab" id="bugTablesTab">Tables</div>
        <div class="tab" id="bugComplianceTab">Compliance Checker</div>
      </div>
      <div class="content" id="bugOrdinanceContent" style="display: none;">
        <a href="https://www.visual-3d.com/tools/photometricviewer/" target="_blank">Visual Photometric Tool - Test your Luminaire's BUG Rating here</a>
        <p>The three components of BUG ratings are based on IES TM-15-07 (revised):</p>
        <p><strong class="compliance-label" style="color: orange;">Backlight</strong>, which creates light trespass onto adjacent sites. The B rating takes into account the amount of light in the BL, BM, BH, and BVH zones, which are in the direction of the luminaire opposite from the area intended to be lighted.</p>
        <p><strong class="compliance-label" style="color: blue;">Uplight</strong>, which causes artificial sky glow. Lower uplight (zone UL) causes the most sky glow and negatively affects professional and academic astronomy. Upper uplight (UH) not reflected off a surface is mostly energy waste. The U rating defines the amount of light into the upper hemisphere with greater concern for the light at or near the horizontal angles (UL).</p>
        <p><strong class="compliance-label" style="color: green;">Glare</strong>, which can be annoying or visually disabling. The G rating takes into account the amount of frontlight in the FH and FVH zones as well as BH and BVH zones.</p>
        <img src="https://img201.yun300.cn/repository/image/37a4c63e-8b6f-4372-8445-35d15786cd86.jpg?tenantId=186088&viewType=1&k=1701685113000" alt="Descriptive text for your image" style="display: block; margin: 0 auto; max-width: 100%; height: auto;">
        <p><strong style="color: orange;">Backlight Subzones</strong>
        <ul>
          <li><strong>BVH:</strong> Backlight Very High (80-90 degrees)</li>
          <li><strong>BH:</strong> Backlight High (60-80 degrees)</li>
          <li><strong>BM:</strong> Backlight Mid (30-60 degrees)</li>
          <li><strong>BL:</strong> Backlight Low (0-30 degrees)</li>
        </ul>
        <p><strong style="color: blue;">Uplight Subzones</strong>
        <ul>
          <li><strong>UH:</strong> Uplight High (100-180 degrees)</li>
          <li><strong>UL:</strong> Uplight Low (90-100 degrees)</li>
        </ul>
        <p><strong style="color: green;">Glare Subzones</strong>
        <ul>
          <li><strong>FVH:</strong> Forward light Very High (80-90 degrees)</li>
          <li><strong>FH:</strong> Forward light High (60-80 degrees)</li>
          <li><strong>FM:</strong> Forward light Mid (30-60 degrees)</li>
          <li><strong>FL:</strong> Forward light Low (0-30 degrees)</li>
        </ul>
      </div>
      <div class="content" id="bugTablesContent" style="display: none;">
        <!-- Residential Tables Content will include Table G -->
        <div id="updatebugTablesContent">
          <!-- Original Table G content is generated by getResidentialTableG() -->
        </div>
      </div>
      <div class="content" id="bugComplianceContent" style="display: none;">
      </div>
    </div>

    <!-- Non‑residential Nested Section -->
    <div id="nonResidentialNested" class="nested" style="display: none;">
      <div class="tabs">
        <div class="tab" id="nrPrescriptiveTab">Prescriptive</div>
        <div class="tab" id="nrPerformanceTab">Performance</div>
      </div>
      <!-- When Non‑residential is first selected, only the top-level secondary tabs show. -->
      <!-- Prescriptive Nested Section -->
      <div id="prescriptiveNested" class="nested" style="display: none;">
        <div class="tabs">
          <div class="tab" id="prescriptiveOrdinanceTab">Ordinance</div>
          <div class="tab" id="prescriptiveTablesTab">Tables</div>
          <div class="tab" id="prescriptiveComplianceTab">Compliance Checker</div>
        </div>
        <div class="content" id="prescriptiveOrdinanceContent" style="display: none;">
          <h2>Prescriptive Method</h2>
          <p>An outdoor lighting installation complies with this section if it meets the requirements of subsections 1 and 2, below.</p>
          <h3>1. Total Site Lumens</h3>
          <ul>
            <li>The total installed initial luminaire lumens for all outdoor lighting must not exceed the total site lumen limit.</li>
            <li>The total site lumen limit is determined using either the Parking Space Method (Table A) or the Hardscape Area Method (Table B). Only one method can be used per permit application.</li>
            <li>For sites with existing lighting, the lumens from existing lighting must be included in the calculation of total installed lumens.</li>
            <li>The total installed initial luminaire lumens are calculated as the sum of the initial luminaire lumens for all luminaires.</li>
          </ul>
          <h3>2. Limits to Off-Site Impacts</h3>
          <p>All luminaires must be rated and installed according to Table C.</p>
        </div>
        <div class="content" id="prescriptiveTablesContent" style="display: none;">
          <!-- Dynamic Tables for Prescriptive with Section Titles -->
          <div id="prescriptiveTablesWrapper"></div>
        </div>
        <div class="content" id="prescriptiveComplianceContent" style="display: none;">
          <!-- NEW CONTENT ADDED TO THE PRESCRIPTIVE COMPLIANCE CHECKER TAB ONLY -->
          <h2>Dark Sky Compliance: Non-residential Prescriptive Method</h2>
          <h3>1. Total Site Lumens Compliance Checker</h3>
          <p>Please select the compliance calculation method:</p>
          <label>
            <input type="radio" name="prescriptiveMethod" value="A" onchange="updatePrescriptiveComplianceOption()" /> Table A: Per Parking Space Method
          </label>
          <label>
            <input type="radio" name="prescriptiveMethod" value="B" onchange="updatePrescriptiveComplianceOption()" /> Table B: Hardscape Area Method
          </label>
          <div id="prescriptiveComplianceOptionContainer"></div>
          <h3>2. Limits to Off-Site Impacts Compliance Checker</h3>
          <!-- The copied Table C for Compliance Checker functionality is generated within getPrescriptiveComplianceTableCCompliance() -->
          <div id="prescriptiveComplianceTableCContainer"></div>
          <button onclick="printPDF('prescriptiveTablesContent')">Print PDF of Current Tab</button>
        </div>
      </div>
      <!-- Performance Nested Section -->
      <div id="performanceNested" class="nested" style="display: none;">
        <div class="tabs">
          <div class="tab" id="performanceOrdinanceTab">Ordinance</div>
          <div class="tab" id="performanceTablesTab">Tables</div>
          <div class="tab" id="performanceComplianceTab">Compliance Checker</div>
        </div>
        <div class="content" id="performanceOrdinanceContent" style="display: none;">
          <h2>Performance Method</h2>
          <h3>1. Total Site Lumens</h3>
          <ul>
            <li>The total installed initial luminaire lumens of all lighting systems on the site must not exceed the allowed total initial site lumens.</li>
            <li>The allowed total initial site lumens will be determined using Tables D and E.</li>
            <li>For sites with existing lighting, the lumens from existing lighting must be included in the calculation of total installed lumens.</li>
            <li>The total installed initial luminaire lumens are calculated as the sum of the initial luminaire lumens for all luminaires.</li>
          </ul>
          <h3>2. Limits to Off-Site Impacts</h3>
          <p>All luminaires must be rated and installed according to either Option A or Option B—only one can be used per permit application.</p>
          <p><strong>Option A:</strong><br>
          Luminaires must be rated and installed according to Table C.</p>
          <p><strong>Option B:</strong><br>
          The entire outdoor lighting design must be analyzed using industry-standard lighting software, taking inter-reflections into account:</p>
          <ul>
            <li><strong>Input data:</strong> This includes details of the lighting system such as luminaire locations, mounting heights, aiming directions, and photometric data tested per IES guidelines. Additionally, physical objects within three object heights of the property line must be included.</li>
            <li><strong>Analysis:</strong> It must utilize an enclosure with calculation planes and zero reflectance around the perimeter of the site. The top of the enclosure must be at least 33 feet (10 meters) above the tallest luminaire. The analysis includes:
              <ul>
                <li>Total lumens on the inside surfaces of the enclosure.</li>
                <li>Maximum vertical illuminance (footcandles or lux) on the sides of the enclosure.</li>
              </ul>
            </li>
          </ul>
          <p><strong>Compliance:</strong><br>
          The design is compliant if:<br>
          ▪ The total lumens on the inside surfaces of the virtual enclosure are less than 15% of the total site lumen limit.<br>
          ▪ The maximum vertical illuminance on any vertical surface is less than the allowed maximum illuminance per Table F.</p>
        </div>
        <div class="content" id="performanceTablesContent" style="display: none;">
          <!-- Dynamic Tables for Performance with Section Titles -->
          <div id="performanceTablesWrapper"></div>
        </div>
        <div class="content" id="performanceComplianceContent" style="display: none;">
          <h2 class="section-title">1. Total Site Lumens</h2>
          <!-- Insert the Performance Compliance copies of Table D and Table E below -->
          <div id="performanceComplianceTableDContainer">
            <div>
              <script>
                document.write(getPerformanceComplianceTableD());
              </script>
            </div>
          </div>
          <div id="performanceComplianceTableEContainer">
            <div>
              <script>
                document.write(getPerformanceComplianceTableE());
              </script>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>

    function printPDF(containerId) {
      var container = document.getElementById(containerId);
      if (!container) {
        alert("Container not found.");
        return;
      }
      
      // Create a new jsPDF instance.
      const pdf = new window.jspdf.jsPDF('p', 'pt', 'a4');
      
      // Define margins and compute effective dimensions.
      const margin = 72;
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();
      const effectiveWidth = pageWidth - margin * 2;
      const effectiveHeight = pageHeight - margin * 2;
      
      // Get container's actual dimensions.
      const containerWidth = container.offsetWidth;
      const containerHeight = container.offsetHeight;
      
      // Calculate scale factors for width and height.
      const scaleFactorWidth = effectiveWidth / containerWidth;
      const scaleFactorHeight = effectiveHeight / containerHeight;
      
      // Use the smaller scale factor to ensure the content fits both horizontally and vertically.
      const scaleFactor = Math.min(scaleFactorWidth, scaleFactorHeight);
      
      // Render the HTML content with the computed scaling.
      pdf.html(container, {
        x: margin,
        y: margin,
        html2canvas: {
          scale: scaleFactor
        },
        callback: function(doc) {
          doc.save("download.pdf");
        }
      });
    }

    // Modified function to extract numeric parts from alphanumeric strings for compliance checks.
    function checkCompliance(element) {
      let maxStr = element.dataset.max;
      let inputStr = element.value;
      let maxNum = parseFloat(maxStr.replace(/[^\d\.]/g, ''));
      let inputNum = parseFloat(inputStr.replace(/[^\d\.]/g, ''));
      if (isNaN(inputNum)) {
        element.style.backgroundColor = "";
        element.title = "";
        return;
      }
      if (inputNum <= maxNum) {
        element.style.backgroundColor = "lightgreen";
        element.title = "";
      } else {
        element.style.backgroundColor = "lightcoral";
        element.title = "Value exceeds maximum allowed lumens.";
      }
    }
    
    // --- Existing Functions for Residential Table G ---
    function getResidentialTableG() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const rows = [
        { description: "Row 1: Maximum Allowed Luminaire Lumens for Unshielded Luminaires at one entry only*", unit: "lumens", LZ0: 0, LZ1: 420, LZ2: 630, LZ3: 630, LZ4: 630 },
        { description: "Row 2: Maximum Allowed Luminaire Lumens for each Fully Shielded Luminaire*", unit: "lumens", LZ0: 630, LZ1: 1260, LZ2: 1260, LZ3: 1260, LZ4: 1260 },
        { description: "Row 3: Maximum Allowed Luminaire Lumens for each Unshielded Luminaire excluding main entry*", unit: "lumens", LZ0: 0, LZ1: 315, LZ2: 315, LZ3: 315, LZ4: 315 },
        { description: "Row 4: Maximum Allowed Luminaire Lumens for each Landscape Lighting*", unit: "lumens", LZ0: 0, LZ1: 0, LZ2: 1050, LZ3: 2100, LZ4: 2100 },
        { description: "Row 5: Maximum Allowed Luminaire Lumens for each Shielded Directional Flood Lighting*", unit: "lumens", LZ0: 0, LZ1: 0, LZ2: 1260, LZ3: 2100, LZ4: 2100 },
        { description: "Row 6: Maximum Allowed Luminaire Lumens for each Low Voltage Landscape Lighting*", unit: "lumens", LZ0: 0, LZ1: 0, LZ2: 525, LZ3: 525, LZ4: 525 }
      ];
      let html = `<h3 class="table-title">Table G - Residential Lighting Limits</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone}</th>
            </tr>
          </thead>
          <tbody>`;
      rows.forEach(row => {
        const value = row[zone];
        html += `<tr>
                  <td>${row.description}</td>
                  <td>${row.unit}</td>
                  <td>${value}</td>
                </tr>`;
      });
      html += `</tbody></table>
        <p style="text-align:left; font-size:0.9em;">* Luminaire lumens equals Initial Lamp Lumens for a lamp, multiplied by the number of lamps in the luminaire</p>`;
      return html;
    }
    
    // New function to generate the Residential Compliance Checker table based on Table G
    function getResidentialComplianceTable() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const rows = [
        { description: "Row 1: Maximum Allowed Luminaire Lumens for Unshielded Luminaires at one entry only*", unit: "lumens", LZ0: 0, LZ1: 420, LZ2: 630, LZ3: 630, LZ4: 630 },
        { description: "Row 2: Maximum Allowed Luminaire Lumens for each Fully Shielded Luminaire*", unit: "lumens", LZ0: 630, LZ1: 1260, LZ2: 1260, LZ3: 1260, LZ4: 1260 },
        { description: "Row 3: Maximum Allowed Luminaire Lumens for each Unshielded Luminaire excluding main entry*", unit: "lumens", LZ0: 0, LZ1: 315, LZ2: 315, LZ3: 315, LZ4: 315 },
        { description: "Row 4: Maximum Allowed Luminaire Lumens for each Landscape Lighting*", unit: "lumens", LZ0: 0, LZ1: 0, LZ2: 1050, LZ3: 2100, LZ4: 2100 },
        { description: "Row 5: Maximum Allowed Luminaire Lumens for each Shielded Directional Flood Lighting*", unit: "lumens", LZ0: 0, LZ1: 0, LZ2: 1260, LZ3: 2100, LZ4: 2100 },
        { description: "Row 6: Maximum Allowed Luminaire Lumens for each Low Voltage Landscape Lighting*", unit: "lumens", LZ0: 0, LZ1: 0, LZ2: 525, LZ3: 525, LZ4: 525 }
      ];
      let html = `<h3 class="table-title">Table G - Residential Lighting Limits</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone} max. value</th>
              <th>Compliance</th>
            </tr>
          </thead>
          <tbody>`;
      rows.forEach((row, index) => {
        const maxVal = row[zone];
        html += `<tr>
                  <td>${row.description}</td>
                  <td>${row.unit}</td>
                  <td>${maxVal}</td>
                  <td><input type="number" data-max="${maxVal}" oninput="checkCompliance(this)" /></td>
                </tr>`;
      });
      html += `</tbody></table>
        <p style="text-align:left; font-size:0.9em;">* Luminaire lumens equals Initial Lamp Lumens for a lamp, multiplied by the number of lamps in the luminaire</p>`;
      return html;
    }
    
    // --- Existing Dynamic Functions for Prescriptive, Performance Tables, etc. ---
    function getPrescriptiveTableA() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const tableAValues = { LZ0: 350, LZ1: 490, LZ2: 630, LZ3: 840, LZ4: 1050 };
      const value = tableAValues[zone] || "N/A";
      return `
        <h3 class="table-title">Table A - Allowed Total Initial Luminaire Lumens per Site for Non‑residential Outdoor Lighting, Per Parking Space Method</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>May only be applied to properties up to 10 parking spaces (including handicapped accessible spaces).</td>
              <td>lumens per parking space</td>
              <td>${value}</td>
            </tr>
          </tbody>
        </table>
      `;
    }
    
    function getPrescriptiveTableBCombined() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const baseValue = { LZ0: 5.4, LZ1: 13.5, LZ2: 26.9, LZ3: 53.8, LZ4: 80.7 }[zone] || "N/A";
      const additionalAllowances = [
        { title: "Outdoor Sales Lots", unit: "lumen per square meter", description: "luminaires must be within 2 mounting heights of sales lot area.", values: { LZ0: 0, LZ1: 43.1, LZ2: 86.1, LZ3: 172.2, LZ4: 172.2 } },
        { title: "Outdoor Sales Frontage", unit: "lumens per meter", description: "luminaires must be located between the principal viewing location and the frontage outdoor sales area", values: { LZ0: 0, LZ1: 0, LZ2: 3280, LZ3: 4921, LZ4: 6561 } },
        { title: "Drive‑Up Windows", unit: "lumens per window", description: "luminaires must be within 1.8 meters horizontal distance of the center of the window.", values: { LZ0: 0, LZ1: 2000, LZ2: 4000, LZ3: 8000, LZ4: 8000 } },
        { title: "Vehicle Service Station", unit: "lumens per pump", description: "This allowance is lumens per installed fuel pump.", values: { LZ0: 0, LZ1: 4000, LZ2: 8000, LZ3: 16000, LZ4: 24000 } }
      ];
      let html = `
        <h3 class="table-title">Table B - Allowed Total Initial Luminaire Lumens per Site for Non‑residential Outdoor Lighting, Hardscape Area Method</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="3" style="text-align: center; font-weight: bold;">Base Allowance</td>
            </tr>
            <tr>
              <td>Hardscape only</td>
              <td>lumen per square meter</td>
              <td>${baseValue}</td>
            </tr>
            <tr>
              <td colspan="3" style="text-align: center; font-weight: bold;">Additional Allowance (max 2 per site)</td>
            </tr>
      `;
      additionalAllowances.forEach(item => {
        html += `
          <tr>
            <td><strong>${item.title}</strong> ${item.description}</td>
            <td>${item.unit}</td>
            <td>${item.values[zone]}</td>
          </tr>
        `;
      });
      html += `
          </tbody>
        </table>
      `;
      return html;
    }
    
    function getPrescriptiveTableCCombined() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const tableC1Rows = [
        { description: "Greater than 2 mounting heights from property line", values: { LZ0: "B1", LZ1: "B3", LZ2: "B4", LZ3: "B5", LZ4: "B5" } },
        { description: "1 to less than 2 mounting heights from property line and ideally oriented**", values: { LZ0: "B1", LZ1: "B2", LZ2: "B3", LZ3: "B4", LZ4: "B4" } },
        { description: "0.5 to 1 mounting heights from property line and ideally oriented**", values: { LZ0: "B0", LZ1: "B1", LZ2: "B2", LZ3: "B3", LZ4: "B3" } },
        { description: "Less than 0.5 mounting height to property line and properly oriented**", values: { LZ0: "B0", LZ1: "B0", LZ2: "B0", LZ3: "B1", LZ4: "B2" } }
      ];
      const tableC2Rows = [
        { description: "Allowed Uplight Rating", values: { LZ0: "U0", LZ1: "U1", LZ2: "U2", LZ3: "U3", LZ4: "U4" } },
        { description: "Allowed % Light Emission Above 90º for Street or Area Lighting", values: { LZ0: "0%", LZ1: "0%", LZ2: "0%", LZ3: "0%", LZ4: "0%" } }
      ];
      const tableC3Rows = [
        { description: "Allowed Glare Rating", values: { LZ0: "G0", LZ1: "G1", LZ2: "G2", LZ3: "G3", LZ4: "G4" } },
        { description: "Any luminaire not ideally oriented*** with 1 to less than 2 mounting heights to any property line of concern**", values: { LZ0: "G0", LZ1: "G0", LZ2: "G1", LZ3: "G1", LZ4: "G2" } },
        { description: "Any luminaire not ideally oriented*** with 0.5 to 1 mounting heights to any property line of concern**", values: { LZ0: "G0", LZ1: "G0", LZ2: "G0", LZ3: "G1", LZ4: "G1" } },
        { description: "Any luminaire not ideally oriented*** with less than 0.5 mounting heights to any property line of concern**", values: { LZ0: "G0", LZ1: "G0", LZ2: "G0", LZ3: "G0", LZ4: "G1" } }
      ];
      let html = `
        <h3 class="table-title">Table C - Maximum Allowable Backlight, Uplight, and Glare Ratings</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>${zone}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="2" style="text-align: center; font-weight: bold;">Table C‑1 – Allowed Backlight Rating*</td>
            </tr>`;
      tableC1Rows.forEach(row => {
        html += `<tr><td>${row.description}</td><td>${row.values[zone]}</td></tr>`;
      });
      html += `<tr><td colspan="2" style="text-align: center; font-weight: bold;">Table C‑2 – Maximum Allowable Uplight</td></tr>`;
      tableC2Rows.forEach(row => {
        html += `<tr><td>${row.description}</td><td>${row.values[zone]}</td></tr>`;
      });
      html += `<tr><td colspan="2" style="text-align: center; font-weight: bold;">Table C‑3 – Maximum Allowable Glare</td></tr>`;
      tableC3Rows.forEach(row => {
        html += `<tr><td>${row.description}</td><td>${row.values[zone]}</td></tr>`;
      });
      html += `</tbody></table>
        <p class="asterisk-remarks">
          *For property lines that abut public walkways, bikeways, plazas, and parking lots, the property line may be considered to be 1.5 meters beyond the actual property line for the purpose of determining compliance with this section. For property lines that abut public roadways and public transit corridors, the property line may be considered to be the centerline of the public roadway or public transit corridor for the purpose of determining compliance with this section. NOTE: This adjustment is relative to Table C‑1 and C‑3 only and shall not be used to increase the lighting area of the site.<br>
          **To be considered 'ideally oriented', the luminaire must be mounted with the backlight portion of the light output oriented perpendicular and towards the property line of concern.<br>
          ***Any luminaire that cannot be mounted with its backlight perpendicular to any property line within 2X the mounting heights of the luminaire location shall meet the reduced Allowed Glare Rating in Table C‑3.
        </p>`;
      return html;
    }
    
    // New function: Generate a copy of Table C with Compliance Checker functionality for Prescriptive Compliance Checker tab.
    function getPrescriptiveComplianceTableCCompliance() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const tableC1Rows = [
        { description: "Greater than 2 mounting heights from property line", values: { LZ0: "B1", LZ1: "B3", LZ2: "B4", LZ3: "B5", LZ4: "B5" } },
        { description: "1 to less than 2 mounting heights from property line and ideally oriented**", values: { LZ0: "B1", LZ1: "B2", LZ2: "B3", LZ3: "B4", LZ4: "B4" } },
        { description: "0.5 to 1 mounting heights from property line and ideally oriented**", values: { LZ0: "B0", LZ1: "B1", LZ2: "B2", LZ3: "B3", LZ4: "B3" } },
        { description: "Less than 0.5 mounting height to property line and properly oriented**", values: { LZ0: "B0", LZ1: "B0", LZ2: "B0", LZ3: "B1", LZ4: "B2" } }
      ];
      const tableC2Rows = [
        { description: "Allowed Uplight Rating", values: { LZ0: "U0", LZ1: "U1", LZ2: "U2", LZ3: "U3", LZ4: "U4" } },
        { description: "Allowed % Light Emission Above 90º for Street or Area Lighting", values: { LZ0: "0%", LZ1: "0%", LZ2: "0%", LZ3: "0%", LZ4: "0%" } }
      ];
      const tableC3Rows = [
        { description: "Allowed Glare Rating", values: { LZ0: "G0", LZ1: "G1", LZ2: "G2", LZ3: "G3", LZ4: "G4" } },
        { description: "Any luminaire not ideally oriented*** with 1 to less than 2 mounting heights to any property line of concern**", values: { LZ0: "G0", LZ1: "G0", LZ2: "G1", LZ3: "G1", LZ4: "G2" } },
        { description: "Any luminaire not ideally oriented*** with 0.5 to 1 mounting heights to any property line of concern**", values: { LZ0: "G0", LZ1: "G0", LZ2: "G0", LZ3: "G1", LZ4: "G1" } },
        { description: "Any luminaire not ideally oriented*** with less than 0.5 mounting heights to any property line of concern**", values: { LZ0: "G0", LZ1: "G0", LZ2: "G0", LZ3: "G0", LZ4: "G1" } }
      ];
      let html = `
        <h3 class="table-title">Table C - Maximum Allowable Backlight, Uplight, and Glare Ratings</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>${zone} max. value</th>
              <th>Compliance</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="3" style="text-align: center; font-weight: bold;">Table C‑1 – Allowed Backlight Rating*</td>
            </tr>`;
      tableC1Rows.forEach(row => {
        html += `<tr>
          <td>${row.description}</td>
          <td>${row.values[zone]}</td>
          <td><input type="text" class="compliance-input" data-max="${row.values[zone]}" oninput="checkCompliance(this)" /></td>
        </tr>`;
      });
      html += `<tr>
              <td colspan="3" style="text-align: center; font-weight: bold;">Table C‑2 – Maximum Allowable Uplight</td>
            </tr>`;
      tableC2Rows.forEach(row => {
        html += `<tr>
          <td>${row.description}</td>
          <td>${row.values[zone]}</td>
          <td><input type="text" class="compliance-input" data-max="${row.values[zone]}" oninput="checkCompliance(this)" /></td>
        </tr>`;
      });
      html += `<tr>
              <td colspan="3" style="text-align: center; font-weight: bold;">Table C‑3 – Maximum Allowable Glare</td>
            </tr>`;
      tableC3Rows.forEach(row => {
        html += `<tr>
          <td>${row.description}</td>
          <td>${row.values[zone]}</td>
          <td><input type="text" class="compliance-input" data-max="${row.values[zone]}" oninput="checkCompliance(this)" /></td>
        </tr>`;
      });
      html += `</tbody></table>
        <p class="asterisk-remarks">
          *For property lines that abut public walkways, bikeways, plazas, and parking lots, the property line may be considered to be 1.5 meters beyond the actual property line for the purpose of determining compliance with this section. For property lines that abut public roadways and public transit corridors, the property line may be considered to be the centerline of the public roadway or public transit corridor for the purpose of determining compliance with this section. NOTE: This adjustment is relative to Table C‑1 and C‑3 only and shall not be used to increase the lighting area of the site.<br>
          **To be considered 'ideally oriented', the luminaire must be mounted with the backlight portion of the light output oriented perpendicular and towards the property line of concern.<br>
          ***Any luminaire that cannot be mounted with its backlight perpendicular to any property line within 2X the mounting heights of the luminaire location shall meet the reduced Allowed Glare Rating in Table C‑3.
        </p>`;
      return html;
    }
    
    function getPerformanceTableD() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const tableDValues = {
        LZ0: { sqm: 5.4, site: 0 },
        LZ1: { sqm: 13.5, site: 3500 },
        LZ2: { sqm: 26.9, site: 7000 },
        LZ3: { sqm: 53.8, site: 14000 },
        LZ4: { sqm: 80.7, site: 21000 }
      };
      const values = tableDValues[zone] || { sqm: "N/A", site: "N/A" };
      return `
        <h3 class="table-title">Table D - Allowed Total Initial Site Lumens</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Total initial lumens per square meter of hardscape</td>
              <td>lumens per square meter</td>
              <td>${values.sqm}</td>
            </tr>
            <tr>
              <td>Total initial site lumens</td>
              <td>lumens per site</td>
              <td>${values.site}</td>
            </tr>
          </tbody>
        </table>
      `;
    }

    function getPerformanceTableE() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const allowancesSection1 = [
        { title: "Building Entrances or Exits", unit: "lumens per door", description: "Luminaires must be within 6 meters of the door.", values: { LZ0: 400, LZ1: 1000, LZ2: 2000, LZ3: 4000, LZ4: 6000 } },
        { title: "Building Facades", unit: "lumens per square meter", description: "Luminaires must be aimed at the façade and capable of illuminating it without obstruction.", values: { LZ0: 0, LZ1: 0, LZ2: 86.1, LZ3: 172.2, LZ4: 258.3 } },
        { title: "Drive‑Up Windows", unit: "lumens per window", description: "Luminaires must be within 6 meters of the center of the window.", values: { LZ0: 0, LZ1: 2000, LZ2: 4000, LZ3: 8000, LZ4: 8000 } },
        { title: "Sales or Non‑Sales Canopies", unit: "lumens per square meter", description: "Luminaires must be located under the canopy.", values: { LZ0: 0, LZ1: 32.3, LZ2: 64.6, LZ3: 129.2, LZ4: 193.8 } },
        { title: "Guard Stations", unit: "lumens per square meter", description: "This allowance is lumens per unit area of guardhouse plus 186 square meter per vehicle lane. Luminaires must be within 2 mounting heights of a vehicle lane or the guardhouse.", values: { LZ0: 0, LZ1: 64.6, LZ2: 129.2, LZ3: 258.3, LZ4: 387.5 } },
        { title: "Outdoor Dining", unit: "lumens per square meter", description: "Luminaires must be within 2 mounting heights of the hardscape area of outdoor dining.", values: { LZ0: 0, LZ1: 10.8, LZ2: 53.8, LZ3: 107.6, LZ4: 161.5 } }
      ];
      const allowancesSection2 = [
        { title: "Vehicle Service Station Hardscape", unit: "lumens per square meter", description: "Luminaires must be illuminating the hardscape area and must not be within a building, below a canopy, beyond property lines, or obstructed by a sign or other structure.", values: { LZ0: 0, LZ1: 43.1, LZ2: 86.1, LZ3: 172.2, LZ4: 258.3 } },
        { title: "Vehicle Service Station Canopies", unit: "lumens per square meter", description: "Luminaires must be located under the canopy.", values: { LZ0: 0, LZ1: 86.1, LZ2: 172.2, LZ3: 344.4, LZ4: 344.4 } }
      ];
      const allowancesSection3 = [
        { title: "Outdoor Sales Lots", unit: "lumens per square meter", description: "Area shall not exceed 25% of the total hardscape area. Luminaires must be within 2 mounting heights of the sales lot area.", values: { LZ0: 0, LZ1: 43.1, LZ2: 86.1, LZ3: 129.2, LZ4: 193.75 } },
        { title: "Outdoor Sales Frontage", unit: "lumens per meter", description: "Luminaires must be located between the principal viewing location and the frontage outdoor sales area.", values: { LZ0: 0, LZ1: 0, LZ2: 304.8, LZ3: 457.2, LZ4: 609.6 } }
      ];
      let html = `
        <h3 class="table-title">Table E - Additional Initial Luminaire Lumen Allowances</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone}</th>
            </tr>
          </thead>
          <tbody>
            <!-- Section 1 -->
            <tr>
              <td colspan="3" style="text-align: center; font-weight: bold;">
                Additional Lumens Allowances for All Buildings except service stations and outdoor sales facilities. A MAXIMUM OF THREE (3) ALLOWANCES ARE PERMITTED. THESE ALLOWANCES ARE “USE IT OR LOSE IT”.
              </td>
            </tr>`;
      allowancesSection1.forEach(item => {
        html += `
          <tr>
            <td><strong>${item.title}</strong> ${item.description}</td>
            <td>${item.unit}</td>
            <td>${item.values[zone]}</td>
          </tr>
        `;
      });
      // Section 2
      html += `
            <tr>
              <td colspan="3" style="text-align: center; font-weight: bold;">
                Additional Lumens Allowances for Service Stations only. Service stations may not use any other additional allowances.
              </td>
            </tr>`;
      allowancesSection2.forEach(item => {
        html += `
          <tr>
            <td><strong>${item.title}</strong> ${item.description}</td>
            <td>${item.unit}</td>
            <td>${item.values[zone]}</td>
          </tr>
        `;
      });
      // Section 3
      html += `
            <tr>
              <td colspan="3" style="text-align: center; font-weight: bold;">
                Additional Lumens Allowances for Outdoor Sales facilities only. Outdoor Sales facilities may not use any other additional allowances. NOTICE: Lighting permitted by these allowances shall employ controls extinguishing this lighting after a curfew time to be determined by the Authority.
              </td>
            </tr>`;
      allowancesSection3.forEach(item => {
        html += `
          <tr>
            <td><strong>${item.title}</strong> ${item.description}</td>
            <td>${item.unit}</td>
            <td>${item.values[zone]}</td>
          </tr>
        `;
      });
      html += `
          </tbody>
        </table>
      `;
      return html;
    }

    function getPerformanceTableF() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const tableFValues = {
        LZ0: { description: "Vertical Illuminance", value: 0.5 },
        LZ1: { description: "Vertical Illuminance", value: 1 },
        LZ2: { description: "Vertical Illuminance", value: 3 },
        LZ3: { description: "Vertical Illuminance", value: 8 },
        LZ4: { description: "Vertical Illuminance", value: 15 }
      };
      const data = tableFValues[zone] || { description: "N/A", value: "N/A" };
      return `
        <h3 class="table-title">Table F - Maximum Vertical Illuminance at any point in the plane of the property line</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>${data.description}</td>
              <td>Lux</td>
              <td>${data.value}</td>
            </tr>
          </tbody>
        </table>
      `;
    }

    // New functions: Copies of Table D and Table E for the Compliance tab

    function getPerformanceComplianceTableD() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const tableDValues = {
        LZ0: { sqm: 5.4, site: 0 },
        LZ1: { sqm: 13.5, site: 3500 },
        LZ2: { sqm: 26.9, site: 7000 },
        LZ3: { sqm: 53.8, site: 14000 },
        LZ4: { sqm: 80.7, site: 21000 }
      };
      const values = tableDValues[zone] || { sqm: "N/A", site: "N/A" };
      const sqm = parseFloat(values.sqm);
      const site = parseFloat(values.site);
      const total = (!isNaN(sqm) && !isNaN(site)) ? sqm + site : "N/A";
      return `
        <h3 class="table-title">Table D - Allowed Total Initial Site Lumens</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Total initial lumens per square meter of hardscape</td>
              <td>lumens per square meter</td>
              <td>${values.sqm}</td>
            </tr>
            <tr>
              <td>Total initial site lumens</td>
              <td>lumens per site</td>
              <td>${values.site}</td>
            </tr>
          </tbody>
        </table>
        <p id="tableDTotalText" style="text-align: right;"><strong>Table D Total = ${total}</strong></p>
      `;
    }

    // Define the function globally (outside of getPerformanceComplianceTableE)
    function updateTableETotal() {
      // Select all checkboxes with the class "tableE-checkbox"
      const checkboxes = document.querySelectorAll('.tableE-checkbox');
      let sum = 0;
      checkboxes.forEach(chk => {
        if (chk.checked) {
          // parseFloat returns a number or NaN; we default to 0 if NaN
          sum += parseFloat(chk.value) || 0;
        }
      });
      document.getElementById('tableETotalText').textContent = 'Table E Total = ' + sum;
      updateOverallTotal();
    }
    
    
    function updatePerformanceOffsiteOption() {
      const option = document.querySelector('input[name="performanceOffsiteOption"]:checked');
      if (!option) {
        document.getElementById('performanceOffsiteOptionContainer').innerHTML = "";
        return;
      }
      if (option.value === "A") {
        // For Option A, show the content from getPrescriptiveComplianceTableCCompliance()
        document.getElementById('performanceOffsiteOptionContainer').innerHTML = getPrescriptiveComplianceTableCCompliance();
      } else if (option.value === "B") {
        // For Option B, show the content from getPerformanceComplianceTableF()
        document.getElementById('performanceOffsiteOptionContainer').innerHTML = getPerformanceComplianceTableF();
      }
    }
    
    // New function to update section visibility based on the section checkboxes
    function updateSectionVisibility() {
      document.getElementById('section1').style.display =
        document.getElementById('section1-checkbox').checked ? '' : 'none';
      document.getElementById('section2').style.display =
        document.getElementById('section2-checkbox').checked ? '' : 'none';
      document.getElementById('section3').style.display =
        document.getElementById('section3-checkbox').checked ? '' : 'none';
    }
    
    function getPerformanceComplianceTableE() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
    
      const allowancesSection1 = [
        { title: "Building Entrances or Exits", unit: "lumens per door", description: "Luminaires must be within 6 meters of the door.", values: { LZ0: 400, LZ1: 1000, LZ2: 2000, LZ3: 4000, LZ4: 6000 } },
        { title: "Building Facades", unit: "lumens per square meter", description: "Luminaires must be aimed at the façade and capable of illuminating it without obstruction.", values: { LZ0: 0, LZ1: 0, LZ2: 86.1, LZ3: 172.2, LZ4: 258.3 } },
        { title: "Drive‑Up Windows", unit: "lumens per window", description: "Luminaires must be within 6 meters of the center of the window.", values: { LZ0: 0, LZ1: 2000, LZ2: 4000, LZ3: 8000, LZ4: 8000 } },
        { title: "Sales or Non‑Sales Canopies", unit: "lumens per square meter", description: "Luminaires must be located under the canopy.", values: { LZ0: 0, LZ1: 32.3, LZ2: 64.6, LZ3: 129.2, LZ4: 193.8 } },
        { title: "Guard Stations", unit: "lumens per square meter", description: "This allowance is lumens per unit area of guardhouse plus 186 square meter per vehicle lane. Luminaires must be within 2 mounting heights of a vehicle lane or the guardhouse.", values: { LZ0: 0, LZ1: 64.6, LZ2: 129.2, LZ3: 258.3, LZ4: 387.5 } },
        { title: "Outdoor Dining", unit: "lumens per square meter", description: "Luminaires must be within 2 mounting heights of the hardscape area of outdoor dining.", values: { LZ0: 0, LZ1: 10.8, LZ2: 53.8, LZ3: 107.6, LZ4: 161.5 } }
      ];
      const allowancesSection2 = [
        { title: "Vehicle Service Station Hardscape", unit: "lumens per square meter", description: "Luminaires must be illuminating the hardscape area and must not be within a building, below a canopy, beyond property lines, or obstructed by a sign or other structure.", values: { LZ0: 0, LZ1: 43.1, LZ2: 86.1, LZ3: 172.2, LZ4: 258.3 } },
        { title: "Vehicle Service Station Canopies", unit: "lumens per square meter", description: "Luminaires must be located under the canopy.", values: { LZ0: 0, LZ1: 86.1, LZ2: 172.2, LZ3: 344.4, LZ4: 344.4 } }
      ];
      const allowancesSection3 = [
        { title: "Outdoor Sales Lots", unit: "lumens per square meter", description: "Area shall not exceed 25% of the total hardscape area. Luminaires must be within 2 mounting heights of the sales lot area.", values: { LZ0: 0, LZ1: 43.1, LZ2: 86.1, LZ3: 129.2, LZ4: 193.75 } },
        { title: "Outdoor Sales Frontage", unit: "lumens per meter", description: "Luminaires must be located between the principal viewing location and the frontage outdoor sales area.", values: { LZ0: 0, LZ1: 0, LZ2: 304.8, LZ3: 457.2, LZ4: 609.6 } }
      ];
    
      // Begin constructing the HTML
      let html = `
        <h3 class="table-title">Table E - Additional Initial Luminaire Lumen Allowances</h3>
        <div id="sectionSelectors" style="margin-bottom: 10px;">
          <label>
            <input type="checkbox" id="section1-checkbox" onchange="updateSectionVisibility()">
            All Buildings except service stations and outdoor sales facilities
          </label>
          <label>
            <input type="checkbox" id="section2-checkbox" onchange="updateSectionVisibility()">
            Service Stations only
          </label>
          <label>
            <input type="checkbox" id="section3-checkbox" onchange="updateSectionVisibility()">
            Outdoor Sales facilities only
          </label>
        </div>
        <table id="tableE">
          <thead>
            <tr>
              <th>Select</th>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone}</th>
            </tr>
          </thead>
          <tbody id="section1" style="display: none;">
            <tr>
              <td colspan="4" style="text-align: center; font-weight: bold;">
                Additional Lumens Allowances for All Buildings except service stations and outdoor sales facilities. A MAXIMUM OF THREE (3) ALLOWANCES ARE PERMITTED. THESE ALLOWANCES ARE “USE IT OR LOSE IT”.
              </td>
            </tr>
      `;
      allowancesSection1.forEach(item => {
        html += `
            <tr>
              <td><input type="checkbox" class="tableE-checkbox" value="${item.values[zone]}" onchange="updateTableETotal()"></td>
              <td><strong>${item.title}</strong> ${item.description}</td>
              <td>${item.unit}</td>
              <td>${item.values[zone]}</td>
            </tr>
        `;
      });
      html += `</tbody>
          <tbody id="section2" style="display: none;">
            <tr>
              <td colspan="4" style="text-align: center; font-weight: bold;">
                Additional Lumens Allowances for Service Stations only. Service stations may not use any other additional allowances.
              </td>
            </tr>
      `;
      allowancesSection2.forEach(item => {
        html += `
            <tr>
              <td><input type="checkbox" class="tableE-checkbox" value="${item.values[zone]}" onchange="updateTableETotal()"></td>
              <td><strong>${item.title}</strong> ${item.description}</td>
              <td>${item.unit}</td>
              <td>${item.values[zone]}</td>
            </tr>
        `;
      });
      html += `</tbody>
          <tbody id="section3" style="display: none;">
            <tr>
              <td colspan="4" style="text-align: center; font-weight: bold;">
                Additional Lumens Allowances for Outdoor Sales facilities only. Outdoor Sales facilities may not use any other additional allowances. NOTICE: Lighting permitted by these allowances shall employ controls extinguishing this lighting after a curfew time to be determined by the Authority.
              </td>
            </tr>
      `;
      allowancesSection3.forEach(item => {
        html += `
            <tr>
              <td><input type="checkbox" class="tableE-checkbox" value="${item.values[zone]}" onchange="updateTableETotal()"></td>
              <td><strong>${item.title}</strong> ${item.description}</td>
              <td>${item.unit}</td>
              <td>${item.values[zone]}</td>
            </tr>
        `;
      });
      html += `
          </tbody>
        </table>
        <p id="tableETotalText">Table E Total = 0</p>
        <p id="overallTotalText" style="text-align: right;"><strong>Overall Total = 0</strong></p>
        <p style="text-align: right;"><strong>Compliance:</strong><input type="number" id="projectCompliance" placeholder="" oninput="checkProjectCompliance(this)" />
        </p>
      `;
      return html;
    }

    function getPerformanceTableF() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const tableFValues = {
        LZ0: { description: "Vertical Illuminance", value: 0.5 },
        LZ1: { description: "Vertical Illuminance", value: 1 },
        LZ2: { description: "Vertical Illuminance", value: 3 },
        LZ3: { description: "Vertical Illuminance", value: 8 },
        LZ4: { description: "Vertical Illuminance", value: 15 }
      };
      const data = tableFValues[zone] || { description: "N/A", value: "N/A" };
      return `
        <h3 class="table-title">Table F - Maximum Vertical Illuminance at any point in the plane of the property line</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>${data.description}</td>
              <td>Lux</td>
              <td>${data.value}</td>
            </tr>
          </tbody>
        </table>
      `;
    }
    
        function getPerformanceComplianceTableF() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const tableFValues = {
        LZ0: { description: "Vertical Illuminance", value: 0.5 },
        LZ1: { description: "Vertical Illuminance", value: 1 },
        LZ2: { description: "Vertical Illuminance", value: 3 },
        LZ3: { description: "Vertical Illuminance", value: 8 },
        LZ4: { description: "Vertical Illuminance", value: 15 }
      };
      const data = tableFValues[zone] || { description: "N/A", value: "N/A" };
      return `
        <h3 class="table-title">Table F - Maximum Vertical Illuminance at any point in the plane of the property line</h3>
        <table>
          <thead>
            <tr>
              <th>Description</th>
              <th>Unit</th>
              <th>${zone}</th>
              <th>Compliance</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>${data.description}</td>
              <td>Lux</td>
              <td>${data.value}</td>
              <td>
                <input type="number" 
                       placeholder="Enter value" 
                       oninput="if(parseFloat(this.value) <= ${data.value}) { this.style.backgroundColor = 'lightgreen'; } else { this.style.backgroundColor = 'lightcoral'; }" />
              </td>
            </tr>
          </tbody>
        </table>
      `;
    }
    
    
    function updateOverallTotal() {
      // Retrieve the text content from the Table D total element.
      const tableDText = document.getElementById('tableDTotalText').textContent;
      // Extract the numeric value after the "=" sign.
      const tableDValue = parseFloat(tableDText.split('=')[1].trim()) || 0;
    
      // Retrieve the text content from the Table E total element.
      const tableEText = document.getElementById('tableETotalText').textContent;
      // Extract the numeric value after the "=" sign.
      const tableEValue = parseFloat(tableEText.split('=')[1].trim()) || 0;
    
      // Calculate the overall total.
      const overallTotal = tableDValue + tableEValue;
    
      // Update the element (which should be added to your HTML) with the overall total.
      const overallTotalElement = document.getElementById('overallTotalText');
      if (overallTotalElement) {
        overallTotalElement.innerHTML = '<strong>Overall Total = ' + overallTotal + '</strong>';
      }
    }
    
    // Function to retrieve the overall total (assumes overallTotalText is formatted as "Overall Total = <value>")
    function OverallTotal() {
      const overallText = document.getElementById('overallTotalText').textContent;
      // Split the text on "=" and trim to get the numeric part.
      const total = parseFloat(overallText.split('=')[1].trim());
      return isNaN(total) ? 0 : total;
    }
    
    // Function to check compliance for the Project Compliance textbox
    function checkProjectCompliance(element) {
      const inputNum = parseFloat(element.value);
      const overallTotal = OverallTotal();
      
      // If no valid number is entered, clear any background.
      if (isNaN(inputNum)) {
        element.style.backgroundColor = "";
        element.title = "";
        return;
      }
      
      // Compare the input value to the overall total and set the background color.
      if (inputNum <= overallTotal) {
        element.style.backgroundColor = "lightgreen";
        element.title = "";
      } else {
        element.style.backgroundColor = "lightcoral";
        element.title = "Value exceeds Overall Total.";
      }
    }


    // --- Update Functions ---
    function updatePrescriptiveTablesContent() {
      const tableAHTML = getPrescriptiveTableA();
      const tableBCombinedHTML = getPrescriptiveTableBCombined();
      const tableCCombinedHTML = getPrescriptiveTableCCombined();
      const prescHTML = `<h2 class="section-title">1. Total Site Lumens</h2>` +
                        tableAHTML + tableBCombinedHTML +
                        `<br><br><h2 class="section-title">2. Limits to Off-Site Impacts</h2>` +
                        tableCCombinedHTML;
      document.getElementById('prescriptiveTablesContent').innerHTML = prescHTML;
      document.getElementById('prescriptiveOrdinanceTab').classList.remove('active');
      document.getElementById('prescriptiveTablesTab').classList.add('active');
      document.getElementById('prescriptiveComplianceTab').classList.remove('active');
      document.getElementById('prescriptiveOrdinanceContent').style.display = 'none';
      document.getElementById('prescriptiveTablesContent').style.display = 'block';
      document.getElementById('prescriptiveComplianceContent').style.display = 'none';
    }

    function updateResidentialTablesContent() {
      const tableGHTML = getResidentialTableG();
      document.getElementById('resTablesContent').innerHTML = tableGHTML;
    }
    
    function updatebugTablesContent() {
      const tableCCombinedHTML = getPrescriptiveTableCCombined();
      document.getElementById('bugTablesContent').innerHTML = tableCCombinedHTML;
    }

    function updateResidentialComplianceContent() {
      const complianceHTML = `<h2 class="comp title">Dark Sky Compliance: Residential</h2>` + getResidentialComplianceTable() + `<br><br> <button onclick="printPDF('resComplianceContent')">Print PDF of Current Tab</button>`;
      document.getElementById('resComplianceContent').innerHTML = complianceHTML;
    }
    
    function updatebugComplianceContent() {
      const bugcompHTML =
        `<h2 class="comp title">Dark Sky Compliance: BUG Rating</h2>` + 
        `<style>
          .titleTextbox {
            display: flex;
            align-items: center;
          }
          .titleTextbox h3 {
            margin: 0;
          }
          .titleTextbox input[type="text"] {
            margin-left: 10px;
            font-size: 1.17em; /* Matches the h3 font size */
          }
        </style>
        
        <div class="titleTextbox">
          <h3>Luminaire ID:</h3>
          <input type="text" placeholder="Enter text here">
        </div>` + 
        getPrescriptiveComplianceTableCCompliance() +
        `<br>
        <br>
        <button onclick="printPDF('bugComplianceContent')">Print PDF of Current Tab</button>
        `;
      document.getElementById('bugComplianceContent').innerHTML = bugcompHTML;
    }

    function updatePerformanceTablesContent() {
      const tableDHTML = getPerformanceTableD();
      const tableEHTML = getPerformanceTableE();
      const tableCHTML = getPrescriptiveTableCCombined();
      const tableFHTML = getPerformanceTableF();
      const perfHTML = `<h2 class="section-title">1. Total Site Lumens</h2>` +
                       tableDHTML + tableEHTML +
                       `<br><br><h2 class="section-title">2. Limits to Off-Site Impacts<br><small>Option A.</small></h2>` +
                       tableCHTML +
                       `<h2 class="section-title"><small>Option B</small></h2>` +
                       tableFHTML;
      document.getElementById('performanceTablesContent').innerHTML = perfHTML;
      document.getElementById('performanceOrdinanceTab').classList.remove('active');
      document.getElementById('performanceTablesTab').classList.add('active');
      document.getElementById('performanceComplianceTab').classList.remove('active');
      document.getElementById('performanceOrdinanceContent').style.display = 'none';
      document.getElementById('performanceTablesContent').style.display = 'block';
      document.getElementById('performanceComplianceContent').style.display = 'none';
    }

    // --- New Update Function for Prescriptive Compliance Checker Tab ---
    function updatePrescriptiveComplianceContent() {
      let html = `<h2>Dark Sky Compliance: Non-residential Prescriptive Method</h2>
        <h3>1. Total Site Lumens</h3>
        <p>Please select the compliance calculation method:</p>
        <label>
          <input type="radio" name="prescriptiveMethod" value="A" onchange="updatePrescriptiveComplianceOption()"> Table A: Per Parking Space Method
        </label>
        <label>
          <input type="radio" name="prescriptiveMethod" value="B" onchange="updatePrescriptiveComplianceOption()"> Table B: Hardscape Area Method
        </label>
        <div id="prescriptiveComplianceOptionContainer"></div>
        <h3>2. Limits to Off-Site Impacts</h3>`
        + getPrescriptiveComplianceTableCCompliance() + 
        `<br>
        <br>
        <button onclick="printPDF('prescriptiveComplianceContent')">Print PDF of Current Tab</button>`;
      
      document.getElementById('prescriptiveComplianceContent').innerHTML = html;
    }


    // --- New function: Update the compliance option container based on selected method for Prescriptive Compliance ---
    function updatePrescriptiveComplianceOption() {
      const method = document.querySelector('input[name="prescriptiveMethod"]:checked');
      if (!method) {
        document.getElementById('prescriptiveComplianceOptionContainer').innerHTML = "";
        return;
      }
      if (method.value === "A") {
        document.getElementById('prescriptiveComplianceOptionContainer').innerHTML = getPrescriptiveComplianceTableA();
      } else if (method.value === "B") {
        document.getElementById('prescriptiveComplianceOptionContainer').innerHTML = getPrescriptiveComplianceTableB();
        updateAdditionalAllowances(); // Ensures proper display of max value
      }
    }
    // --- New function: Generate Prescriptive Compliance Table A (Per Parking Space Method) ---
    function getPrescriptiveComplianceTableA() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const tableAValues = { LZ0: 350, LZ1: 490, LZ2: 630, LZ3: 840, LZ4: 1050 };
      const value = tableAValues[zone] || "N/A";
      let html = `<h3 class="table-title">Table A Compliance - Per Parking Space Method</h3>
      <table>
        <thead>
          <tr>
            <th>Description</th>
            <th>Unit</th>
            <th>${zone} max. value</th>
            <th>Compliance</th>
          </tr>
        </thead>
        <tbody>`;
      html += `<tr>
          <td>May only be applied to properties up to 10 parking spaces (including handicapped accessible spaces).</td>
          <td>lumens per parking space</td>
          <td>${value}</td>
          <td><input type="number" class="compliance-input" data-max="${value}" oninput="checkCompliance(this)" /></td>
        </tr>`;
      html += `</tbody></table>`;
      return html;
    }

    // --- New function: Generate Prescriptive Compliance Table B (Hardscape Area Method) ---
    function getPrescriptiveComplianceTableB() {
      const zone = document.getElementById('lightingZone').value;
      if (!zone) {
        return "<p>Please select a lighting zone from the drop-down menu</p>";
      }
      const baseValue = { LZ0: 5.4, LZ1: 13.5, LZ2: 26.9, LZ3: 53.8, LZ4: 80.7 }[zone] || 0;
      const additionalAllowances = [
        { title: "Outdoor Sales Lots", unit: "lumen per square meter", description: "luminaires must be within 2 mounting heights of sales lot area.", value: { LZ0: 0, LZ1: 43.1, LZ2: 86.1, LZ3: 172.2, LZ4: 172.2 }[zone] },
        { title: "Outdoor Sales Frontage", unit: "lumens per meter", description: "luminaires must be located between the principal viewing location and the frontage outdoor sales area", value: { LZ0: 0, LZ1: 0, LZ2: 3280, LZ3: 4921, LZ4: 6561 }[zone] },
        { title: "Drive‑Up Windows", unit: "lumens per window", description: "luminaires must be within 1.8 meters horizontal distance of the center of the window.", value: { LZ0: 0, LZ1: 2000, LZ2: 4000, LZ3: 8000, LZ4: 8000 }[zone] },
        { title: "Vehicle Service Station", unit: "lumens per pump", description: "This allowance is lumens per installed fuel pump.", value: { LZ0: 0, LZ1: 4000, LZ2: 8000, LZ3: 16000, LZ4: 24000 }[zone] }
      ];
      let html = `<h3 class="table-title">Table B Compliance - Hardscape Area Method</h3>`;
      html += `<p><strong>Base Value: ${baseValue} lumens per square meter</strong></p>`;
      html += `<p><strong>Select up to two additional allowances:</strong></p>`;
      html += `<table>
        <thead>
          <tr>
            <th>Select</th>
            <th>Allowance</th>
            <th>Unit</th>
            <th>${zone} max. value</th>
          </tr>
        </thead>
        <tbody>`;
      additionalAllowances.forEach((item, index) => {
        html += `<tr>
          <td><input type="checkbox" class="allowance-checkbox" onchange="updateAdditionalAllowances()" value="${item.value}" id="allowance_${index}" /></td>
          <td>${item.title} - ${item.description}</td>
          <td>${item.unit}</td>
          <td>${item.value}</td>
        </tr>`;
      });
      html += `</tbody></table>`;
      html += `<p id="allowanceMessage" style="color:red;"></p>`;
      html += `<p id="tableBMaxDisplay" style="font-weight: bold;">Maximum Allowed Value: </p>`;
      html += `<p style="text-align: right;"><strong>Compliance:</strong><input type="number" id="tableBProjectValue" class="compliance-input" oninput="checkCompliance(this)" data-max="0" /></p>`;
      return html;
    }

    function updateAdditionalAllowances() {
      const checkboxes = document.querySelectorAll('.allowance-checkbox');
      let selected = [];
      checkboxes.forEach(chk => {
        if (chk.checked) {
          selected.push(parseFloat(chk.value));
        }
      });
      let message = "";
      if (selected.length > 2) {
        message = "Maximum two Additional Allowances Allowed";
        const last = selected.pop();
        checkboxes.forEach(chk => {
          if (parseFloat(chk.value) === last && chk.checked) {
            chk.checked = false;
          }
        });
      }
      document.getElementById("allowanceMessage").textContent = message;
      const zone = document.getElementById('lightingZone').value;
      const baseValue = { LZ0: 5.4, LZ1: 13.5, LZ2: 26.9, LZ3: 53.8, LZ4: 80.7 }[zone] || 0;
      let totalMax = baseValue;
      selected.forEach(val => totalMax += val);
      document.getElementById("tableBMaxDisplay").textContent = "Maximum Allowed Value: " + totalMax;
      const projInput = document.getElementById("tableBProjectValue");
      if (projInput) {
        projInput.dataset.max = totalMax;
        checkCompliance(projInput);
      }
    }

    // --- Attach update functions to the lighting zone drop-down ---
    document.getElementById('lightingZone').addEventListener('change', function() {
      // Update Prescriptive and Residential sections as before.
      if (document.getElementById('prescriptiveComplianceTab').classList.contains('active')) {
        updatePrescriptiveComplianceContent();
      } else {
        updatePrescriptiveTablesContent();
      }
      updateResidentialTablesContent();
      updateResidentialComplianceContent();

    // For Performance section, update based on the active sub‑tab.
      if (document.getElementById('performanceComplianceTab').classList.contains('active')) {
        document.getElementById('performanceComplianceContent').innerHTML = `
          <h2 class="comp title">Dark Sky Compliance: Non-residential Performance Method</h2>
          <h3 class="section-title1">1. Total Site Lumens</h3>
          ${getPerformanceComplianceTableD()}
          ${getPerformanceComplianceTableE()}
          <h3 class="section-title2">2. Limits to Off‑Site Impacts</h3>
          <label>
            <input type="radio" name="performanceOffsiteOption" value="A" onchange="updatePerformanceOffsiteOption()" checked>
            Option A
          </label>
          <label>
            <input type="radio" name="performanceOffsiteOption" value="B" onchange="updatePerformanceOffsiteOption()">
            Option B
          </label>
          <div id="performanceOffsiteOptionContainer"></div>
          <br>
          <br>
          <button onclick="printPDF('performanceComplianceContent')">Print PDF of Current Tab</button>
        `;
        updateOverallTotal();
        updatePerformanceOffsiteOption();
      } else {
        updatePerformanceTablesContent();
      }
      if (document.getElementById('bugTablesTab').classList.contains('active')) {
      updatebugTablesContent();
      }
      if (document.getElementById('bugComplianceTab').classList.contains('active')) {
      updatebugComplianceContent();
      }
    });

    // --- Main Tab and Nested Tabs Handling ---
    const residentialMainTab = document.getElementById('residentialMainTab');
    const nonResidentialMainTab = document.getElementById('nonResidentialMainTab');
    const bugMainTab = document.getElementById('bugMainTab');
    const residentialNested = document.getElementById('residentialNested');
    const nonResidentialNested = document.getElementById('nonResidentialNested');
    const bugNested = document.getElementById('bugNested');

    residentialMainTab.addEventListener('click', () => {
      residentialMainTab.classList.add('active');
      nonResidentialMainTab.classList.remove('active');
      bugMainTab.classList.remove('active');
      residentialNested.style.display = 'block';
      nonResidentialNested.style.display = 'none';
      bugNested.style.display = 'none';
      document.getElementById('resOrdinanceTab').classList.add('active');
      document.getElementById('resOrdinanceContent').style.display = 'block';
      document.getElementById('resTablesTab').classList.remove('active');
      document.getElementById('resComplianceTab').classList.remove('active');
      document.getElementById('resTablesContent').style.display = 'none';
      document.getElementById('resComplianceContent').style.display = 'none';
    });

    nonResidentialMainTab.addEventListener('click', () => {
      nonResidentialMainTab.classList.add('active');
      residentialMainTab.classList.remove('active');
      bugMainTab.classList.remove('active');
      nonResidentialNested.style.display = 'block';
      residentialNested.style.display = 'none';
      bugNested.style.display = 'none';
      document.getElementById('prescriptiveNested').style.display = 'none';
      document.getElementById('performanceNested').style.display = 'none';
      document.getElementById('nrPrescriptiveTab').classList.remove('active');
      document.getElementById('nrPerformanceTab').classList.remove('active');
    });
    
    bugMainTab.addEventListener('click', () => {
      bugMainTab.classList.add('active');
      nonResidentialMainTab.classList.remove('active');
      residentialMainTab.classList.remove('active');
      bugNested.style.display = 'block';
      nonResidentialNested.style.display = 'none';
      residentialNested.style.display = 'none';
      document.getElementById('bugOrdinanceTab').classList.add('active');
      document.getElementById('bugOrdinanceContent').style.display = 'block';
      document.getElementById('bugTablesTab').classList.remove('active');
      document.getElementById('bugComplianceTab').classList.remove('active');
      document.getElementById('bugTablesContent').style.display = 'none';
      document.getElementById('bugComplianceContent').style.display = 'none';
    });

    // --- Residential Nested Tabs Handling ---
    const resOrdinanceTab = document.getElementById('resOrdinanceTab');
    const resTablesTab = document.getElementById('resTablesTab');
    const resComplianceTab = document.getElementById('resComplianceTab');
    const resOrdinanceContent = document.getElementById('resOrdinanceContent');
    const resTablesContent = document.getElementById('resTablesContent');
    const resComplianceContent = document.getElementById('resComplianceContent');

    resOrdinanceTab.addEventListener('click', () => {
      resOrdinanceTab.classList.add('active');
      resTablesTab.classList.remove('active');
      resComplianceTab.classList.remove('active');
      resOrdinanceContent.style.display = 'block';
      resTablesContent.style.display = 'none';
      resComplianceContent.style.display = 'none';
    });

    resTablesTab.addEventListener('click', () => {
      if (!zoneSelected()) {
        alert("Please select a lighting zone from the drop-down menu");
        return;
      }
      resTablesTab.classList.add('active');
      resOrdinanceTab.classList.remove('active');
      resComplianceTab.classList.remove('active');
      resTablesContent.style.display = 'block';
      resOrdinanceContent.style.display = 'none';
      resComplianceContent.style.display = 'none';
    });

    resComplianceTab.addEventListener('click', () => {
      if (!zoneSelected()) {
        alert("Please select a lighting zone from the drop-down menu");
        return;
      }
      resComplianceTab.classList.add('active');
      resOrdinanceTab.classList.remove('active');
      resTablesTab.classList.remove('active');
      resComplianceContent.style.display = 'block';
      resOrdinanceContent.style.display = 'none';
      resTablesContent.style.display = 'none';
    });
    
    // --- BUG Nested Tabs Handling ---
    const bugOrdinanceTab = document.getElementById('bugOrdinanceTab');
    const bugTablesTab = document.getElementById('bugTablesTab');
    const bugComplianceTab = document.getElementById('bugComplianceTab');
    const bugOrdinanceContent = document.getElementById('bugOrdinanceContent');
    const bugTablesContent = document.getElementById('bugTablesContent');
    const bugComplianceContent = document.getElementById('bugComplianceContent');

    bugOrdinanceTab.addEventListener('click', () => {
      bugOrdinanceTab.classList.add('active');
      bugTablesTab.classList.remove('active');
      bugComplianceTab.classList.remove('active');
      bugOrdinanceContent.style.display = 'block';
      bugTablesContent.style.display = 'none';
      bugComplianceContent.style.display = 'none';
    });

    bugTablesTab.addEventListener('click', () => {
      if (!zoneSelected()) {
        alert("Please select a lighting zone from the drop-down menu");
        return;
      }
      bugTablesTab.classList.add('active');
      bugOrdinanceTab.classList.remove('active');
      bugComplianceTab.classList.remove('active');
      bugTablesContent.style.display = 'block';
      updatebugTablesContent();
      bugOrdinanceContent.style.display = 'none';
      bugComplianceContent.style.display = 'none';
    });

    bugComplianceTab.addEventListener('click', () => {
      if (!zoneSelected()) {
        alert("Please select a lighting zone from the drop-down menu");
        return;
      }
      updatebugComplianceContent();
      bugComplianceTab.classList.add('active');
      bugOrdinanceTab.classList.remove('active');
      bugTablesTab.classList.remove('active');
      bugComplianceContent.style.display = 'block';
      bugOrdinanceContent.style.display = 'none';
      bugTablesContent.style.display = 'none';
    });

    // --- Non‑residential Secondary Tabs Handling ---
    const nrPrescriptiveTab = document.getElementById('nrPrescriptiveTab');
    const nrPerformanceTab = document.getElementById('nrPerformanceTab');
    const prescriptiveNested = document.getElementById('prescriptiveNested');
    const performanceNested = document.getElementById('performanceNested');

    nrPrescriptiveTab.addEventListener('click', () => {
      nrPrescriptiveTab.classList.add('active');
      nrPerformanceTab.classList.remove('active');
      prescriptiveNested.style.display = 'block';
      performanceNested.style.display = 'none';
      document.getElementById('prescriptiveOrdinanceTab').classList.add('active');
      document.getElementById('prescriptiveOrdinanceContent').style.display = 'block';
      document.getElementById('prescriptiveTablesTab').classList.remove('active');
      document.getElementById('prescriptiveComplianceTab').classList.remove('active');
      document.getElementById('prescriptiveTablesContent').style.display = 'none';
      document.getElementById('prescriptiveComplianceContent').style.display = 'none';
    });

    nrPerformanceTab.addEventListener('click', () => {
      nrPerformanceTab.classList.add('active');
      nrPrescriptiveTab.classList.remove('active');
      performanceNested.style.display = 'block';
      prescriptiveNested.style.display = 'none';
      document.getElementById('performanceOrdinanceTab').classList.add('active');
      document.getElementById('performanceOrdinanceContent').style.display = 'block';
      document.getElementById('performanceTablesTab').classList.remove('active');
      document.getElementById('performanceComplianceTab').classList.remove('active');
      document.getElementById('performanceTablesContent').style.display = 'none';
      document.getElementById('performanceComplianceContent').style.display = 'none';
    });

    // --- Nested Tabs for Prescriptive ---
    const prescriptiveOrdinanceTab = document.getElementById('prescriptiveOrdinanceTab');
    const prescriptiveTablesTab = document.getElementById('prescriptiveTablesTab');
    const prescriptiveComplianceTab = document.getElementById('prescriptiveComplianceTab');
    const prescriptiveOrdinanceContent = document.getElementById('prescriptiveOrdinanceContent');
    const prescriptiveTablesContent = document.getElementById('prescriptiveTablesContent');
    const prescriptiveComplianceContent = document.getElementById('prescriptiveComplianceContent');

    prescriptiveOrdinanceTab.addEventListener('click', () => {
      prescriptiveOrdinanceTab.classList.add('active');
      prescriptiveTablesTab.classList.remove('active');
      prescriptiveComplianceTab.classList.remove('active');
      prescriptiveOrdinanceContent.style.display = 'block';
      prescriptiveTablesContent.style.display = 'none';
      prescriptiveComplianceContent.style.display = 'none';
    });

    prescriptiveTablesTab.addEventListener('click', () => {
      if (!zoneSelected()) {
        alert("Please select a lighting zone from the drop-down menu");
        return;
      }
      prescriptiveTablesTab.classList.add('active');
      prescriptiveOrdinanceTab.classList.remove('active');
      prescriptiveComplianceTab.classList.remove('active');
      prescriptiveTablesContent.style.display = 'block';
      prescriptiveOrdinanceContent.style.display = 'none';
      prescriptiveComplianceContent.style.display = 'none';
    });

    prescriptiveComplianceTab.addEventListener('click', () => {
      if (!zoneSelected()) {
        alert("Please select a lighting zone from the drop-down menu");
        return;
      }
      prescriptiveComplianceTab.classList.add('active');
      prescriptiveOrdinanceTab.classList.remove('active');
      prescriptiveTablesTab.classList.remove('active');
      prescriptiveComplianceContent.style.display = 'block';
      prescriptiveOrdinanceContent.style.display = 'none';
      prescriptiveTablesContent.style.display = 'none';
      updatePrescriptiveComplianceContent();
    });

    // --- Nested Tabs for Performance ---
    const performanceOrdinanceTab = document.getElementById('performanceOrdinanceTab');
    const performanceTablesTab = document.getElementById('performanceTablesTab');
    const performanceComplianceTab = document.getElementById('performanceComplianceTab');
    const performanceOrdinanceContent = document.getElementById('performanceOrdinanceContent');
    const performanceTablesContent = document.getElementById('performanceTablesContent');
    const performanceComplianceContent = document.getElementById('performanceComplianceContent');

    performanceOrdinanceTab.addEventListener('click', () => {
      performanceOrdinanceTab.classList.add('active');
      performanceTablesTab.classList.remove('active');
      performanceComplianceTab.classList.remove('active');
      performanceOrdinanceContent.style.display = 'block';
      performanceTablesContent.style.display = 'none';
      performanceComplianceContent.style.display = 'none';
    });

    performanceTablesTab.addEventListener('click', () => {
      if (!zoneSelected()) {
        alert("Please select a lighting zone from the drop-down menu");
        return;
      }
      performanceTablesTab.classList.add('active');
      performanceOrdinanceTab.classList.remove('active');
      performanceComplianceTab.classList.remove('active');
      performanceTablesContent.style.display = 'block';
      performanceOrdinanceContent.style.display = 'none';
      performanceComplianceContent.style.display = 'none';
    });

    performanceComplianceTab.addEventListener('click', () => {
      if (!zoneSelected()) {
        alert("Please select a lighting zone from the drop-down menu");
        return;
      }
      performanceComplianceTab.classList.add('active');
      performanceOrdinanceTab.classList.remove('active');
      performanceTablesTab.classList.remove('active');
      performanceComplianceContent.innerHTML = `
        <h2 class="comp title">Dark Sky Compliance: Non-residential Performance Method</h2>
        <h3 class="section-title1">1. Total Site Lumens</h3>
        ${getPerformanceComplianceTableD()}
        ${getPerformanceComplianceTableE()}
        <h3 class="section-title2">2. Limits to Off‑Site Impacts</h3>
        <label>
          <input type="radio" name="performanceOffsiteOption" value="A" onchange="updatePerformanceOffsiteOption()" checked>
          Option A
        </label>
        <label>
          <input type="radio" name="performanceOffsiteOption" value="B" onchange="updatePerformanceOffsiteOption()">
          Option B
        </label>
        <div id="performanceOffsiteOptionContainer"></div>
        <br>
        <br>
        <button onclick="printPDF('performanceComplianceContent')">Print PDF of Current Tab</button>
      `;
      updatePerformanceOffsiteOption();
      updateOverallTotal();
      
      performanceComplianceContent.style.display = 'block';
      performanceOrdinanceContent.style.display = 'none';
      performanceTablesContent.style.display = 'none';
    });

    // Helper function to check if a lighting zone is selected.
    function zoneSelected() {
      return document.getElementById('lightingZone').value !== "";
    }
  </script>
</body>
</html>
